# Conventional Commits Workflows

This document describes the GitHub workflows for implementing [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/) specification in CloudDrove projects. These workflows help maintain consistent commit messages, automate versioning, and generate changelogs based on commit conventions.

## Overview

The Conventional Commits specification provides a standardized format for commit messages that enables automated tooling and clear communication about changes. Our workflows implement three key aspects:

1. **Commit Message Validation** - Ensures all commits follow the conventional format
2. **PR Title Validation** - Validates pull request titles follow conventional format
3. **Automated Release Management** - Generates versions and changelogs based on commit types

## Workflows

### 1. Conventional Commits Lint

**File:** `.github/workflows/conventional-commits-lint.yml`

Validates that all commit messages in a pull request follow the Conventional Commits specification.

#### Features

- ‚úÖ Validates commit message format
- üéØ Configurable allowed commit types
- üîç Optional scope validation
- üí• Breaking change detection
- üìã Detailed validation feedback

#### Usage

```yaml
name: Validate Commits

on:
  pull_request:
    branches: [ main, master ]

jobs:
  conventional-commits:
    uses: clouddrove/github-shared-workflows/.github/workflows/conventional-commits-lint.yml@master
    with:
      allowed_types: "feat,fix,docs,style,refactor,perf,test,chore,ci,build,revert"
      scopes: "api,ui,docs,config"  # Optional
      breaking_change_token: "BREAKING CHANGE"
    secrets:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

#### Inputs

| Input | Required | Default | Description |
|-------|----------|---------|-------------|
| `allowed_types` | No | `feat,fix,docs,style,refactor,perf,test,chore,ci,build,revert` | Comma-separated list of allowed commit types |
| `scopes` | No | `""` | Comma-separated list of allowed scopes (optional) |
| `breaking_change_token` | No | `BREAKING CHANGE` | Token to identify breaking changes |

#### Commit Types

| Type | Description | Example |
|------|-------------|---------|
| `feat` | A new feature | `feat: add user authentication` |
| `fix` | A bug fix | `fix: resolve memory leak in cache` |
| `docs` | Documentation changes | `docs: update API documentation` |
| `style` | Code style changes | `style: format code with prettier` |
| `refactor` | Code refactoring | `refactor: simplify user service` |
| `perf` | Performance improvements | `perf: optimize database queries` |
| `test` | Adding or updating tests | `test: add unit tests for auth service` |
| `chore` | Maintenance tasks | `chore: update dependencies` |
| `ci` | CI/CD changes | `ci: add automated testing` |
| `build` | Build system changes | `build: update webpack configuration` |
| `revert` | Reverting changes | `revert: revert "feat: add new feature"` |

### 2. PR Title Conventional Commits Check

**File:** `.github/workflows/conventional-commits-pr-title.yml`

Validates that pull request titles follow the Conventional Commits format.

#### Features

- ‚úÖ Validates PR title format
- üéØ Configurable allowed commit types
- üîç Optional scope validation
- üìã Clear validation feedback

#### Usage

```yaml
name: Validate PR Title

on:
  pull_request:
    types: [opened, edited, reopened, synchronize]

jobs:
  pr-title-check:
    uses: clouddrove/github-shared-workflows/.github/workflows/conventional-commits-pr-title.yml@master
    with:
      allowed_types: "feat,fix,docs,style,refactor,perf,test,chore,ci,build,revert"
      scopes: "api,ui,docs,config"  # Optional
    secrets:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

#### Inputs

| Input | Required | Default | Description |
|-------|----------|---------|-------------|
| `allowed_types` | No | `feat,fix,docs,style,refactor,perf,test,chore,ci,build,revert` | Comma-separated list of allowed commit types |
| `scopes` | No | `""` | Comma-separated list of allowed scopes (optional) |

### 3. Conventional Commits Release

**File:** `.github/workflows/conventional-commits-release.yml`

Automatically creates releases and generates changelogs based on conventional commits.

#### Features

- üöÄ Automatic version bumping based on commit types
- üìù Automated changelog generation
- üè∑Ô∏è Git tag creation
- üì¶ GitHub release creation
- üíæ Automatic changelog commits

#### Usage

```yaml
name: Release

on:
  push:
    branches: [ main, master ]

jobs:
  release:
    uses: clouddrove/github-shared-workflows/.github/workflows/conventional-commits-release.yml@master
    with:
      target_branch: master
      initial_version: "1.0.0"
      prerelease: false
      changelog_file: "CHANGELOG.md"
      version_prefix: "v"
    secrets:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

#### Inputs

| Input | Required | Default | Description |
|-------|----------|---------|-------------|
| `target_branch` | Yes | `master` | Target branch for releases |
| `initial_version` | No | `1.0.0` | Initial version if no tags exist |
| `prerelease` | No | `false` | Create prerelease versions |
| `changelog_file` | No | `CHANGELOG.md` | Changelog file path |
| `version_prefix` | No | `v` | Version prefix (e.g., v for v1.0.0) |

#### Version Bumping Rules

| Commit Type | Version Bump | Example |
|-------------|--------------|---------|
| `feat` | Minor | `1.0.0` ‚Üí `1.1.0` |
| `fix` | Patch | `1.0.0` ‚Üí `1.0.1` |
| `feat!` or `BREAKING CHANGE` | Major | `1.0.0` ‚Üí `2.0.0` |
| `docs`, `style`, `refactor`, `perf`, `test`, `chore`, `ci`, `build` | Patch | `1.0.0` ‚Üí `1.0.1` |

## Complete Example

Here's a complete example of how to implement all three workflows in your repository:

### 1. Create `.github/workflows/validate-commits.yml`

```yaml
name: Validate Conventional Commits

on:
  pull_request:
    branches: [ main, master ]

jobs:
  validate-commits:
    uses: clouddrove/github-shared-workflows/.github/workflows/conventional-commits-lint.yml@master
    with:
      allowed_types: "feat,fix,docs,style,refactor,perf,test,chore,ci,build,revert"
      scopes: "api,ui,docs,config,deploy"
    secrets:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  validate-pr-title:
    uses: clouddrove/github-shared-workflows/.github/workflows/conventional-commits-pr-title.yml@master
    with:
      allowed_types: "feat,fix,docs,style,refactor,perf,test,chore,ci,build,revert"
      scopes: "api,ui,docs,config,deploy"
    secrets:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

### 2. Create `.github/workflows/release.yml`

```yaml
name: Release

on:
  push:
    branches: [ main, master ]

jobs:
  release:
    uses: clouddrove/github-shared-workflows/.github/workflows/conventional-commits-release.yml@master
    with:
      target_branch: master
      initial_version: "1.0.0"
      prerelease: false
      changelog_file: "CHANGELOG.md"
      version_prefix: "v"
    secrets:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

## Commit Message Examples

### Basic Format
```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

### Examples

#### Feature
```
feat: add user authentication system

Implement JWT-based authentication with login and registration endpoints.
Includes password hashing and token validation.

Closes #123
```

#### Bug Fix
```
fix(api): resolve memory leak in user service

The user service was not properly cleaning up database connections,
causing memory leaks during high load periods.

Fixes #456
```

#### Breaking Change
```
feat!: redesign user API

BREAKING CHANGE: The user API endpoints have been completely redesigned.
All existing API calls will need to be updated to use the new format.

Migration guide: https://docs.example.com/migration
```

#### With Scope
```
feat(ui): add dark mode toggle

Add a toggle button in the header to switch between light and dark themes.
Includes theme persistence in localStorage.

Closes #789
```

## Best Practices

### 1. Commit Message Guidelines

- Use the imperative mood ("add feature" not "added feature")
- Keep the description under 50 characters
- Capitalize the first letter of the description
- Don't end the description with a period
- Use the body to explain what and why, not how
- Reference issues and pull requests in the footer

### 2. Scope Guidelines

- Use lowercase for scopes
- Use kebab-case for multi-word scopes
- Keep scopes consistent across the project
- Common scopes: `api`, `ui`, `docs`, `config`, `deploy`, `test`

### 3. Breaking Changes

- Use `!` after the type/scope for breaking changes
- Include `BREAKING CHANGE:` in the footer
- Provide migration instructions when possible
- Consider creating a separate migration guide

### 4. Workflow Configuration

- Start with basic types and add more as needed
- Define project-specific scopes
- Use consistent version prefixes
- Consider using prereleases for development branches

## Troubleshooting

### Common Issues

1. **Commit validation fails**
   - Check that commit messages follow the format: `type: description`
   - Ensure the type is in the allowed list
   - Verify scope is allowed (if scopes are configured)

2. **PR title validation fails**
   - Ensure PR title follows conventional format
   - Check that the type is allowed
   - Verify scope is allowed (if scopes are configured)

3. **Release not created**
   - Check that commits are on the target branch
   - Verify GitHub token has necessary permissions
   - Ensure there are conventional commits since the last release

### Debugging

Enable debug logging by adding this to your workflow:

```yaml
- name: Debug
  run: |
    echo "Event: ${{ github.event_name }}"
    echo "Ref: ${{ github.ref }}"
    echo "Target branch: ${{ inputs.target_branch }}"
```

## Migration from Existing Workflows

If you're migrating from the existing tag-release workflow:

1. **Replace label-based versioning** with commit-based versioning
2. **Update commit messages** to follow conventional format
3. **Configure allowed types and scopes** for your project
4. **Test the workflows** in a development branch first

## Support

For issues or questions about these workflows:

- Create an issue in the [github-shared-workflows repository](https://github.com/clouddrove/github-shared-workflows/issues)
- Contact CloudDrove support at [hello@clouddrove.com](mailto:hello@clouddrove.com)

## References

- [Conventional Commits Specification](https://www.conventionalcommits.org/en/v1.0.0/)
- [Semantic Versioning](https://semver.org/)
- [GitHub Actions Documentation](https://docs.github.com/en/actions)
