# ğŸš€ Terraform Module Auto Tag Release Guide

This guide explains how to automatically version, tag, and release Terraform modules using a shared GitHub Actions workflow. It supports multi-module repositories and uses semantic versioning with commit messages.

---

## ğŸ“¦ What It Does

- Detects which Terraform modules changed.
- Reads commit messages to determine version bump (**major, minor, patch, no-release**).
- Creates Git tags like:
  ```
  terraform-aws-vpc/1.2.3
  ```
- Pushes new tags to the repository.

---

## âœ¨ Key Features

âœ… Multi-module support (only tags changed modules).  
ğŸ”– Semantic version bumping (major, minor, patch).  
ğŸ·ï¸ Git tags in format `module-name/1.2.3`.  
ğŸ“¦ Reusable workflow across multiple repos.  

---

## ğŸ§© How It Works

1. You modify one or more modules inside repo (e.g., `terraform-aws-vpc/`).
2. You commit changes with version bump in commit message:
   - `major`, `minor`, `patch`, `no-release`
   - Must include **module name** in commit message.
3. After PR merge:
   - Workflow detects changed module(s).
   - Reads latest tags, bumps version.
   - Creates and pushes new Git tag.

---

## ğŸ› ï¸ Setup Instructions

### 1. Add Shared Workflow to Your Repo

In your repo (`.github/workflows/terraform-module-tag-release.yml`):

```yaml
name: ğŸš€ Terraform Module Auto Tag Release

on:
  push:
    branches:
      - master

permissions:
  contents: write

jobs:
  module-release:
    uses: clouddrove/github-shared-workflows/.github/workflows/terraform-module-tag-release.yml@master
```

---

### ğŸ”– Initial Tagging (First Release)

Before using the workflow, you must tag each module with a base version (`1.0.0`).

Run this script locally:

```bash
#!/bin/bash

modules=("terraform-aws-labels" "terraform-aws-security-group" "terraform-aws-subnet")  # Replace as per your modules
version="1.0.0"

for module in "${modules[@]}"; do
  tag="${module}/${version}"
  git tag "$tag"
  echo "âœ… Tagged $tag"
done

git push --tags
```

---

## ğŸ“ Commit Message Guidelines

Version bump depends on commit message:

- **major** â†’ Breaking changes (API change, incompatible updates, big refactor).
- **minor** â†’ New features (backward-compatible, adds functionality).
- **patch** â†’ Bug fixes / small changes (backward-compatible).
- **no-release** â†’ Skip tagging (docs, comments, refactor only).

### Examples:

```bash
git commit -m "major: (terraform-aws-ec2) migrated from t2.micro to t3.micro instances (breaking change)"
git commit -m "minor: (terraform-aws-ec2) added support for multiple security groups"
git commit -m "patch: (terraform-aws-ec2) fixed incorrect AMI ID in default configuration"
git commit -m "no-release: (terraform-aws-ec2) updated documentation for module usage"
```

---

## ğŸ”„ Workflow Usage Rules

- You can change a single module â†’ commit message must contain bump label.  
- You can change multiple modules â†’ commit changes separately, then squash & merge PR.  
- Before merging PR â†’ ensure only latest **2â€“3 relevant commits** exist (remove junk commits).  
- After initial tags, you can continue normal development and bump versions with commit messages.  

âš ï¸ Always:
- Add your module to **master branch**.  
- Run initial tagging script once.  
- Then use workflow for bumps and releases.  

---
